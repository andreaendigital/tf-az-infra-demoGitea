#cloud-config
package_update: true
package_upgrade: true

packages:
  - git
  - wget
  - curl
  - mysql-client

users:
  - name: ${admin_username}
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh_authorized_keys: []

write_files:
  - path: /etc/systemd/system/wait-for-ansible.service
    content: |
      [Unit]
      Description=Wait for Ansible configuration
      After=network.target

      [Service]
      Type=oneshot
      ExecStart=/bin/true
      RemainAfterExit=yes

      [Install]
      WantedBy=multi-user.target

runcmd:
  - systemctl enable wait-for-ansible
  - systemctl start wait-for-ansible
  - echo "Cloud-init completed. Ready for Ansible provisioning." > /var/log/cloud-init-complete.log
